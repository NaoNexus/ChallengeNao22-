<!DOCTYPE html>
<html lang="en">

<head>
    <title>Reports</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(() => { drawChart('co2') });

        function graphSelectionClick(element) {
            drawChart(element.value)
        }

        function drawChart(viewData) {
            var data = new google.visualization.DataTable();
            data.addColumn('date', 'Date');
            data.addColumn('number', 'CO2');
            data.addColumn('number', 'Temperature');
            data.addColumn('number', 'Humidity');

            data.addRows([
                {% for report in reports %}
        [new Date("{{ report['date']}}"), {{ report['co2'] }}, {{ report['temperature'] }}, {{ report['humidity'] }}],
            {% endfor %}
            ]);

        var view = new google.visualization.DataView(data);

        switch (viewData) {
            case 'co2':
                view.hideColumns([2, 3]);
                break;
            case 'temperature':
                view.hideColumns([1, 3]);
                break;
            case 'humidity':
                view.hideColumns([1, 2]);
                break;
            default:
                view.hideColumns([2, 3]);
                break;
        }

        var options = {
            title: 'Sensor reports',
            curveType: 'function',
            legend: { position: 'bottom' }
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

        chart.draw(view, options);
        }
    </script>
</head>

<body class="bg-slate-500">
    <div class="mx-40 my-10 p-10 rounded-xl bg-slate-50 space-y-4">
        <h1 class="text-2xl font-medium text-slate-800">REPORTS GRAPH</h1>
        <div id="curve_chart" class="w-full h-[500px] rounded-lg overflow-hidden bg-transparent"></div>
        <div class="flex flex-row mt-2 space-x-2">
            <input class="hidden peer/co2" checked type="radio" id="co2" name="contact"
                onclick="graphSelectionClick(this);" value="co2" />
            <label
                class="py-1 px-3 text-xl font-medium text-slate-800 border-2 border-slate-300 rounded-full peer-checked/co2:bg-sky-500 peer-checked/co2:text-white peer-checked/co2:border-0"
                for="co2">CO2</label>
            <input class="hidden peer/temp" type="radio" id="temperature" name="contact"
                onclick="graphSelectionClick(this);" value="temperature" />
            <label
                class="py-1 px-3 text-xl font-medium text-slate-800 border-2 border-slate-300 rounded-full peer-checked/temp:bg-sky-500 peer-checked/temp:text-white peer-checked/temp:border-0"
                for="temperature">TEMPERATURE</label>
            <input class="hidden peer/hum" type="radio" id="humidity" name="contact"
                onclick="graphSelectionClick(this);" value="humidity" />
            <label
                class="py-1 px-3 text-xl font-medium text-slate-800 border-2 border-slate-300 rounded-full peer-checked/hum:bg-sky-500 peer-checked/hum:text-white peer-checked/hum:border-0"
                for="humidity">HUMIDITY</label>
        </div>
    </div>
    <div class="mx-40 my-10 p-10 rounded-xl bg-slate-50 space-y-4">
        <h1 class="text-2xl font-medium text-slate-800">REPORTS LIST</h1>
        <table class="w-full border-2 border-slate-200">
            <thead>
                <tr>
                    <th class="border-2 border-slate-200">ID</th>
                    <th class="border-2 border-slate-200">Date</th>
                    <th class="border-2 border-slate-200">CO2</th>
                    <th class="border-2 border-slate-200">Temperature</th>
                    <th class="border-2 border-slate-200">Humidity</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <th class="border-x-2 border-slate-200 text-center">{{report['id']}}</th>
                    <td class="border-x-2 border-slate-200 text-center">{{report['date']}}</td>
                    <td class="border-x-2 border-slate-200 text-center">{{report['co2']}} PPM</td>
                    <td class="border-x-2 border-slate-200 text-center">{{report['temperature']}} Â°C</td>
                    <td class="border-x-2 border-slate-200 text-center">{{report['humidity']}} %</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>

</html>